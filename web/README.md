# 人设切换插件 Web 管理界面

## 功能介绍

这个 Web 管理界面为人设切换插件提供了完整的管理功能，包括：

### 📋 人设配置管理
- **白名单设置**: 控制哪些人设可以被当前人设看到和切换
- **黑名单设置**: 隐藏指定的人设，使其不出现在可切换列表中
- **触发词配置**: 设置关键词，当用户消息包含这些词时自动切换到对应人设
- **人设隔离**: 开启后该人设的聊天记录独立存储

### 📊 会话任务管理
- 查看所有活跃的会话任务
- 清空或删除指定会话的任务
- 实时查看任务内容和状态

### 📈 统计信息
- 配置的人设总数
- 活跃任务数量
- 总会话数
- 触发词总数

## 访问方式

插件路由将挂载在以下路径：
```
/plugins/Zaxpris.change_preset/
```

## API 端点

### 人设相关
- `GET /presets` - 获取所有人设信息
- `GET /preset-settings` - 获取人设配置
- `GET /preset-settings/{preset_id}` - 获取指定人设配置
- `PUT /preset-settings/{preset_id}` - 更新人设配置
- `DELETE /preset-settings/{preset_id}` - 删除人设配置

### 任务相关
- `GET /tasks` - 获取所有会话任务
- `GET /tasks/{chat_key}` - 获取指定会话任务
- `DELETE /tasks/{chat_key}` - 删除指定会话任务
- `POST /tasks/{chat_key}/clear` - 清空指定会话任务

### 其他
- `GET /statistics` - 获取统计信息
- `GET /static/{file_path}` - 静态文件服务

## 配置说明

### 白名单/黑名单配置
- 输入人设ID列表，多个ID用逗号分隔
- 例如: `1, 2, 3` 或 `default, 5, 8`
- 留空表示无限制

### 触发词配置
- 输入触发词列表，多个词用逗号分隔
- 例如: `切换, 换人设, 变身`
- 当用户消息包含任何一个触发词时，会自动切换到对应人设

### 人设隔离
- 开启后，该人设的聊天记录会独立存储
- 适用于需要保持独立对话上下文的场景

## 使用流程

1. **配置人设**: 在"人设配置"页面为每个人设设置白名单、黑名单、触发词等
2. **监控任务**: 在"会话任务"页面查看和管理活跃的会话任务
3. **查看统计**: 在"统计信息"页面了解插件的整体使用情况

## 注意事项

- 配置更改会实时生效
- 删除配置操作不可撤销，请谨慎操作
- 任务清空和删除的区别：
  - 清空：将任务内容设为空，但保留任务记录
  - 删除：完全移除任务记录

## 技术实现

- **后端**: FastAPI + Pydantic 数据验证
- **前端**: 原生 HTML + CSS + JavaScript
- **数据存储**: 使用插件配置系统自动持久化
- **API 设计**: RESTful 风格，支持 JSON 数据交换
